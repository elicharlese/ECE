"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.addProjectRootToRspackPluginExcludesIfExists = addProjectRootToRspackPluginExcludesIfExists;
const devkit_1 = require("@nx/devkit");
const devkit_2 = require("@nx/devkit");
function addProjectRootToRspackPluginExcludesIfExists(tree, projectRoot) {
    const excludeProjectGlob = (0, devkit_1.joinPathFragments)(projectRoot, '/**');
    const nxJson = (0, devkit_2.readNxJson)(tree);
    if (!nxJson.plugins?.length) {
        return;
    }
    for (let i = 0; i < nxJson.plugins.length; i++) {
        let plugin = nxJson.plugins[i];
        const isRspackPlugin = typeof plugin === 'string'
            ? plugin === '@nx/rspack/plugin'
            : plugin.plugin === '@nx/rspack/plugin';
        if (isRspackPlugin) {
            if (typeof plugin === 'string') {
                plugin = {
                    plugin: plugin,
                    exclude: [excludeProjectGlob],
                };
            }
            else {
                plugin.exclude = [...(plugin.exclude ?? []), excludeProjectGlob];
            }
            nxJson.plugins[i] = plugin;
        }
    }
    (0, devkit_1.updateNxJson)(tree, nxJson);
}
