# üß≠ Windsurf Global Rules

**Activation Mode:** *Always On* ‚Äî enforced across **all** branches and workspaces.

---

## 1. Code Style (tag: CS)

- ‚úÖ All code must be written in **TypeScript** (never use `.js` unless auto‚Äëgenerated).
- UI must use **React + Tailwind CSS**, with atomic component design and **PascalCase filenames**.
- Use **named exports** only; barrel files are allowed *only* as `index.ts` within a folder.
- Apply **Zod** (or equivalent) for runtime validation; keep types in `src/types/` for reuse.

---

## 2. Project Structure & App Generation (tag: PS)

```
apps/            # Nx-managed platforms (React web + Expo mobile/desktop)
libs/            # Shared TS code, UI libs, hooks, test utilities
tools/           # Generators, CLI helpers, scripts
docs/
‚îú‚îÄ guidelines.md
‚îú‚îÄ architecture/   # Mermaid C4 diagrams (context, containers, components)
‚îú‚îÄ patches/
‚îî‚îÄ batches/
public/
scripts/
README.md
END_GOAL.md
```

- All repos should *start with* **Nx React/TypeScript monorepo**:

```bash
npx create-nx-workspace @your-org/<name> \
  --preset=react-ts \
  --appName=web \
  --style=css \
  --defaultBase=main \
  --no-interactive
```

- Add mobile & web apps via:

```bash
nx g @nx/expo:app mobile --no-interactive
```

- Bundle Expo Web builds into desktop targets using Electron or Tauri manually.
- For real-time, offline-first apps (e.g., chat, live sync), default to Meteor backend + @meteorrn/core in Expo/RN clients (leveraging DDP pub/sub sync).

‚∏ª

## 3. CLI Flag Enforcement (tag: CS/BR)

All CLI scaffolding commands must include explicit, non-interactive flags:
 ‚Ä¢ Nx Init:

```bash
npx create-nx-workspace ‚Ä¶ --preset=react-ts --appName=web --style=css \
  --defaultBase=main --no-interactive
```

 ‚Ä¢ Expo App:

```bash
nx g @nx/expo:app mobile --no-interactive
```

‚ö†Ô∏è If AI diverges (e.g. for a custom backend or different stack), it must:

 1. Branch from proposed-tech/<name>
 2. Write the precise altered CLI command under a reason: bullet in PATCHN_SUMMARY.md

Missing or incorrect flags must trigger creation of PATCHN_ISSUES.md and halt AI execution.

‚∏ª

## 4. Dev Flow: Patches & Batches (tag: DF)

1. Use patch/batch cycles:
 ‚Ä¢ Patch folders at /docs/patches/patch-N/: with PATCHN_CHECKLIST.md and PATCHN_SUMMARY.md
 ‚Ä¢ Batch folders at /docs/batches/batch-N/: with BATCHN_CHECKLIST.md and BATCHN_SUMMARY.md
2. Patch-level sequence should be:
 /plan-feature-set ‚Üí develop ‚Üí AI auto-check (lint, typecheck, test, build) ‚Üí commit & tag ‚Üí DemoMode
 ‚Ä¢ On failure, AI writes PATCHN_ISSUES.md, and waits.
3. Once all patch checklists are done, update the batch summary and close the batch.

‚∏ª

## 5. Documentation & End Goal (tag: DS)

 ‚Ä¢ The file docs/guidelines.md is the source of truth for naming, checklist structure, CLI flags (Section 5 in guidelines), and architecture folder policy.
 ‚Ä¢ All patch and batch files must match the formatting in guidelines.md.
 ‚Ä¢ END_GOAL.md (located at repo root) contains final product criteria. AI may read but never modify it.
 ‚Ä¢ Each feature in patches must map back to items in END_GOAL.md.

‚∏ª

## 6. AI Autonomy & Self‚ÄëCheck (tag: AI)

Before concluding a patch:
 ‚Ä¢ AI must verify all code compiles and avoids any.
 ‚Ä¢ Ensure UI uses React + Tailwind (no inline styles, atomic pattern).
 ‚Ä¢ Validate test coverage ‚â•90% for modifications.
 ‚Ä¢ Confirm all CLI commands used match default flags policy.
 ‚Ä¢ If not, AI stops and populates PATCHN_ISSUES.md with a table of failed checks.

‚∏ª

## 7. Branching for Stack Deviations (tag: BR)

For unusual tech decisions (e.g. Flutter, custom RN, backend stack):

1. Create proposed-tech/<name> branch with:
   - Minimal working CLI-generated POC
   - Markdown rationale (pros/cons, maintenance)

2. Await human review before further development.
3. If approved, merge into patch branch, update patch summary, and revise global_rules.md if necessary.

## 8. Versioning & Semantic Tags (tag: TG)

- Commit messages must include tags like: CS, PS, DF, AI, DS, BR
- feat[patch-3](CS, DF): scaffold Expo mobile+web app using Nx and default flags
- Versions must follow semantic-release (e.g., v0.1.0 for patch/batch milestones), generated on merge to main.

‚∏ª

üîÅ Workflow Overview (for Windsurf ‚Üî Kilo)

| Step | Command / Action | Purpose |
|------|------------------|---------|
| 1. | /bootstrap-templates | Scaffold docs/guidelines.md, END_GOAL.md, README.md, .windsurfrules.md; tag v0.0.1 |
| 2. | /pipeline (push to main) | Generate kilo-pipeline.yml CI; tag v0.1.0 |
| 3. | /plan-feature-set | Scope patch‚ÄëN features and include default CLI flag commands |
| 4. | /batch-start-N (e.g., /batch-start-1) | Create docs subfolders, checkout windsprint/batch-N branch |
| 5. | Dev & Review | AI enforces global rules, runs self-checks, and prepares commits |
| 6. | Merge to main | Kilo CI/CD runs: lint ‚Üí tests ‚Üí build ‚Üí semantic release ‚Üí deploy |
| 7. | /release-sync | Closes batch docs, opens next patch/batch cycle automatically |
| 8. | Loop | Continue until all boxes in END_GOAL.md are checked off; Windsurf stops then |

‚∏ª

‚úÖ Summary

global_rules.md defines deterministic, audit-friendly development standards for Windsurf. It mandates:
‚Ä¢ Flag-based CLI scaffolding (Nx, Expo, Meteor) with no prompting
‚Ä¢ Strict org-wide patch/batch cycles aligned to END_GOAL.md
‚Ä¢ AI-driven self-checks before commit or branching
‚Ä¢ Tracking & human oversight when deviating from defaults
‚Ä¢ Clear handoff to Kilo for CI/CD and product release

Once all checkboxes in END_GOAL.md are marked, Windsurf's process completes and the product is considered release‚Äëready with Kilo's pipeline fully operational.
